---
layout: post
show_meta: true
title: Using RDS Proxy in FastAPI
header: Using RDS Proxy in FastAPI
date: 2024-06-19 00:00:00
summary: Using RDS Proxy in FastAPI
categories: python fastapi rds proxy
author: Chee Yeo
---


TODO

To allow RDS to work with Aurora PostgresSQL:

* if RDS db is encrypted, need to set encryption on for the proxy else will fail with:

```
2024-06-20T09:42:59.513Z [INFO] [proxyEndpoint=default] [clientConnection=1356935739] Proxy authentication with PostgreSQL native password authentication failed for user "postgres" with TLS off. Reason: TLS is required by the current configuration. If you're using the PostgreSQL CLI, use the flag sslmode=require in 8.4 or newer versions.
```

* Enable the logging option when creating proxy as it enables easier debugging

* To allow fastapi to communicate with proxy, need the following settings for SqlAlchemy:

```
SQLALCHEMY_DATABASE_URL = f"postgresql+psycopg2://{os.getenv('DB_USER')}:{os.getenv('DB_PASSWORD')}@{os.getenv('DB_HOST')}:5432/{os.getenv('DB_NAME')}?sslmode=require"


engine = create_engine(
    SQLALCHEMY_DATABASE_URL,
    echo=True,
    pool_size=10,
    max_overflow=2,
    pool_recycle=3600,
    pool_pre_ping=True,
    pool_use_lifo=True
)
```

since fastapi uses pools of threads via uvicorn, we need to set the pool size in the create_engine config ???

