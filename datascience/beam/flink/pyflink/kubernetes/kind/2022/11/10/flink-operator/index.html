<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Using Flink Kubernetes Operator for BEAM and pyflink workflows &#8211; Blog of software writer Chee Yeo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Using Flink Kubernetes Operator for BEAM and pyflink">
    <meta name="author" content="Chee Yeo">
    <meta name="keywords" content="datascience, beam, flink, pyflink, kubernetes, kind">
    <link rel="canonical" href="https://www.cheeyeo.dev/datascience/beam/flink/pyflink/kubernetes/kind/2022/11/10/flink-operator/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Blog of software writer Chee Yeo" href="/feed.xml" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?202211231740" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_UK">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Using Flink Kubernetes Operator for BEAM and pyflink workflows">
    <meta property="og:description" content="Chee Yeo is a software developer with interests in machine learning and cloud computing.">
    <meta property="og:url" content="https://www.cheeyeo.dev/datascience/beam/flink/pyflink/kubernetes/kind/2022/11/10/flink-operator/">
    <meta property="og:site_name" content="Blog of software writer Chee Yeo">
</head>

<body class="">
  <div class="color-line"></div>
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      
        <nav class="site-nav">
          <a href="/">Home</a>
          <a href="https://tilrnt.github.io/" target="_blank">TILRNT</a>
          <a href="/about">About</a>
          <a href="/contact">Contact</a>
        </nav>
      
      <div class="clearfix"></div>
    </div>
  </div>
</header>

    <header class="blog-header">
  <h1 class="blog-title">Using Flink Kubernetes Operator for BEAM and pyflink workflows</h1>

  
  <div class="meta_info">
    
    <div class="author-date-wrap">
      <div class="author">
        <a href="/about">Chee Yeo</a>
      </div>
    </div>
    
    <span class="post-date">November 10, 2022</span>
    
    <ul class="article-tag">
      
      <li>
        <a href="/categories/datascience">datascience</a>
      </li>
      
      <li>
        <a href="/categories/beam">beam</a>
      </li>
      
      <li>
        <a href="/categories/flink">flink</a>
      </li>
      
      <li>
        <a href="/categories/pyflink">pyflink</a>
      </li>
      
      <li>
        <a href="/categories/kubernetes">kubernetes</a>
      </li>
      
      <li>
        <a href="/categories/kind">kind</a>
      </li>
      
    </ul>
    
  </div>
  
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<article class="post-content top-border">
  
<p>In the previous post, I described a process of using docker compose to setup a suite of services to develop and run BEAM jobs on a flink cluster. To mimic production scenarios, we can use a container orchestration platform such as <strong>kubernetes</strong> to manage these services.</p>

<p>In this post, I attempt to highlight the process of setting up a local <strong>kind</strong> cluster to deploy and manage a flink session cluster using the <a href="https://github.com/spotify/flink-on-k8s-operator">Flink Kubernetes operator</a>.</p>

<h3 id="setting-up-the-kind-cluster">Setting up the kind cluster</h3>

<p>To setup a flink cluster in <strong>kind</strong> we need to have kind installed locally.</p>

<p>To create a kind cluster:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kind create cluster <span class="nt">--name</span> flinkcluster <span class="nt">--config</span> kind_config.yaml
</pre></td></tr></tbody></table></code></pre></figure>

<p>The config file I used was documented on the website and as follows:
<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=kind_config.yaml"></script></p>

<p>It exposes the host system ports 80 and 443 to allow the ingress controller to map those ports in order to access the UI which we will describe later.</p>

<p>It also maps a local directory <code class="language-plaintext highlighter-rouge">/tmp/artifacts</code> into the node as type of host path. This can be referenced in pods with the path of <code class="language-plaintext highlighter-rouge">/artifacts</code>. The local directory must be created with the owner and group of <code class="language-plaintext highlighter-rouge">9999</code> before the flink task manager can read/write to it.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /tmp/artifacts

<span class="nb">sudo chown</span> <span class="nt">-R</span> 9999:9999 /tmp/artifacts
</pre></td></tr></tbody></table></code></pre></figure>

<p>Check that the cluster is running and set the kubectl context:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre>kind get clusters

kubectl cluster-info <span class="nt">--context</span> kind-flinkcluster
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="2-setup-and-load-docker-images">2. Setup and load docker images</h3>

<p>Kind cluster doesn’t have access to the local docker images on the host system so they must be preloaded into the cluster. The following are some of the images we preload:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre>kind load docker-image apache/beam_python3.8_sdk:2.41.0 <span class="nt">--name</span> flinkcluster

kind load docker-image apache/flink:1.15.2 <span class="nt">--name</span> flinkcluster

kind load docker-image apache/beam_flink1.15_job_server:2.41.0 <span class="nt">--name</span> flinkcluster

kind load docker-image m1l0/pyflink:1.15.2-scala_2.12 <span class="nt">--name</span> flinkcluster
</pre></td></tr></tbody></table></code></pre></figure>

<p>The first 3 images will be used by the flink session cluster and job server. The last image is a custom image which contains both <strong>python</strong> and <strong>pyflink</strong> installed as the default flink image is designed to run in Java.</p>

<p>The Dockerfile I used is as follows and adapted from <a href="https://github.com/spotify/flink-on-k8s-operator">Flink Kubernetes operator</a>:</p>

<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=Dockerfile.pyflink"></script>

<p>The dockerfile uses apache/flink:1.15.2-scala_2.12 as a base / builder image, installs some flink connectors such as mysql and hadoop and installs and builds python and pyflink.</p>

<h3 id="3-setup-flink-operator">3. Setup Flink operator</h3>

<p>To install the Flink operator, we need to install its dependencies:</p>

<ul>
  <li>certmanager</li>
  <li>ingress nginx controller</li>
</ul>

<p>To install <strong>certmanager</strong></p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kubectl apply <span class="nt">-f</span> https://github.com/jetstack/cert-manager/releases/download/v1.8.1/cert-manager.yaml
</pre></td></tr></tbody></table></code></pre></figure>

<p>Next we install <strong>ingress nginx controller</strong></p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml
</pre></td></tr></tbody></table></code></pre></figure>

<p>The ingress controller will create a ingress object for the flink dashboard.</p>

<p>Next we install the flink operator:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kubectl apply <span class="nt">-f</span> https://github.com/spotify/flink-on-k8s-operator/releases/download/v0.4.2-beta.4/flink-operator.yaml
</pre></td></tr></tbody></table></code></pre></figure>

<p>Next we verify that the flink operator components are installed correctly:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>kubectl get crds | <span class="nb">grep </span>flinkclusters.flinkoperator.k8s.io

kubectl describe crds/flinkclusters.flinkoperator.k8s.io

kubectl get deployments <span class="nt">-n</span> flink-operator-system

kubectl get pods <span class="nt">-n</span> flink-operator-system

kubectl logs <span class="nt">-n</span> flink-operator-system <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>flink-operator <span class="nt">--all-containers</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="4-create-flink-resources">4. Create flink resources</h3>

<p>We need to setup the following resources to create the cluster:</p>

<h4 id="4a-volumes">4.a Volumes</h4>

<p>We create two sets of volumes and persistent volume claims.</p>

<p>We create a <strong>persistent volume</strong> and a <strong>persistent volume claim</strong> as the taskmanager and job server need to share a common staging space to access the uploaded artifacts, similar to the docker setup. This creates a volume on the node at path <code class="language-plaintext highlighter-rouge">/mnt/data</code>, mounted into <code class="language-plaintext highlighter-rouge">/tmp/beam-staging</code> in the pod</p>

<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=flink_pvc.yaml"></script>

<p>The second set of volume and claim creates a volume to store the job artifacts. When applied, if the output path for a job is specified as <code class="language-plaintext highlighter-rouge">/artifacts</code>, the final output can also be accessed locally on the host.</p>

<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=flink_pvc_artifacts.yaml"></script>

<p>Applying the above:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre>kubectl apply <span class="nt">-f</span> flink_pvc.yaml

kubectl apply <span class="nt">-f</span> flink_pvc_artifacts.yaml
</pre></td></tr></tbody></table></code></pre></figure>

<h4 id="4b-flink-session-cluster-and-job-server">4.b Flink session cluster and job server</h4>

<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=flink_session_cluster.yaml"></script>

<p>The flink session cluster is based on a CRD <strong>FlinkCluster</strong> defined by the flink operator. Note that in this example we are defining a <strong>session cluster</strong> hence there is no <strong>job</strong> spec defined. If <strong>job</strong> spec is defined, the operator automatically provisions an <strong>application</strong> cluster which runs the job once and exits.</p>

<p>Another important note is that we are using the custom image we built earlier which includes python and pyflink. This is essential as pyflink jobs will not be able to run and fails with <code class="language-plaintext highlighter-rouge">python not found</code></p>

<p>The python BEAM jobs are not affected by this as we are using the python beam sdk to submit the job which we will show later.</p>

<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=flink_ui_svc.yaml"></script>

<p>The <strong>flink_ui_svc.yaml</strong> creates an Ingress resource in order to allow external traffic to the UI. Since we have exposed ports 80 in our kind cluster, we can access the UI with <code class="language-plaintext highlighter-rouge">localhost/default/ui</code> in the browser.</p>

<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=flink_job_server.yaml"></script>

<p>Applying the above:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>kubectl apply <span class="nt">-f</span> flink_session_cluster.yaml

kubectl apply <span class="nt">-f</span> flink_job_server.yaml

kubectl apply <span class="nt">-f</span> flink_ui_svc.yaml
</pre></td></tr></tbody></table></code></pre></figure>

<p>Check that the resources are deployed correctly and running:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kubectl get pods <span class="nt">-lapp</span><span class="o">=</span>flink
</pre></td></tr></tbody></table></code></pre></figure>

<p>The pods should show status of <code class="language-plaintext highlighter-rouge">running</code> and the UI is accessible at <code class="language-plaintext highlighter-rouge">http://localhost/default/ui/</code></p>

<p><img src="/assets/img/flink/operator/kubectl.png" alt="Kubectl pods status" />
<img src="/assets/img/flink/operator/ui.png" alt="Flink dashboard" /></p>

<p>We can test the current setup using the following example job:</p>

<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=sample_test_job.yaml"></script>

<p>This defines an python beam job using the python sdk. Once the job is created, it gets submitted to the <strong>beam-job-server</strong> service running on port 8099 which translates it into Flink compatible job. The environment_type and environment_config refers to the python BEAM sdk which Flink uses when it executes python code.</p>

<p>The screenshot below shows the job completion in the UI:
<img src="/assets/img/flink/operator/sample_job_ui.png" alt="Flink dashboard" /></p>

<p>Check in the UI and pod logs that the job has completed successfully.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>kubectl logs beam-wordcount-py-jpkqx 

INFO:root:Default Python SDK image <span class="k">for </span>environment is apache/beam_python3.8_sdk:2.41.0
INFO:apache_beam.runners.portability.fn_api_runner.translations:<span class="o">====================</span> &lt;<span class="k">function </span>pack_combiners at 0x7fe9064305e0&gt; <span class="o">====================</span>
INFO:apache_beam.runners.portability.fn_api_runner.translations:<span class="o">====================</span> &lt;<span class="k">function </span>lift_combiners at 0x7fe906430670&gt; <span class="o">====================</span>
INFO:apache_beam.runners.portability.fn_api_runner.translations:<span class="o">====================</span> &lt;<span class="k">function </span>sort_stages at 0x7fe906430dc0&gt; <span class="o">====================</span>
INFO:apache_beam.runners.portability.portable_runner:Job state changed to STOPPED
INFO:apache_beam.runners.portability.portable_runner:Job state changed to STARTING
INFO:apache_beam.runners.portability.portable_runner:Job state changed to RUNNING
INFO:apache_beam.runners.portability.portable_runner:Job state changed to DONE
</pre></td></tr></tbody></table></code></pre></figure>

<p>The job can run on any of the taskmanagers which is referenced in the job UI. The outputs will be stored in the <strong>beam-worker-pool</strong> sidecar container which can be accessed like so:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kubectl <span class="nb">exec</span> <span class="nt">-it</span> beam-flink-cluster-taskmanager-0 <span class="nt">-c</span> beam-worker-pool <span class="nt">--</span> bash
</pre></td></tr></tbody></table></code></pre></figure>

<p>If the <code class="language-plaintext highlighter-rouge">/artifacts</code> path is mounted into the cluster, the output can be accessed locally.</p>

<h3 id="5-running-custom-beam-jobs">5. Running custom BEAM jobs</h3>

<p>To run your own custom BEAM job we need to:</p>

<ul>
  <li>
    <p>Create a custom docker image using the apache python SDK image with the custom python files / modules loaded.</p>
  </li>
  <li>
    <p>Create a kubernetes job spec with the above custom image.</p>
  </li>
  <li>
    <p>Submit the job into the kubernetes cluster.</p>
  </li>
</ul>

<p>A dockerfile could look like this:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="c"># Example dockerfile to build a custom image to run beam job</span>
FROM apache/beam_python3.8_sdk:2.41.0 as builder

WORKDIR /opt/flink

COPY beam_example.py .
</pre></td></tr></tbody></table></code></pre></figure>

<p>Here we use the <strong>apache/beam_python3.8_sdk:2.41.0</strong> as the builder image and add our python beam code into the image.</p>

<p>The sdk image has already been preloaded into the kind cluster earlier. Next we need to load this custom job image into the cluster:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kind load docker-image beam:custom <span class="nt">--name</span> flinkcluster
</pre></td></tr></tbody></table></code></pre></figure>

<p>A job manifest <strong>flink_beam_example.yaml</strong> can look like this:
<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=flink_beam_example.yaml"></script></p>

<p>To submit the job:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kubectl apply <span class="nt">-f</span> flink_beam_example.yaml
</pre></td></tr></tbody></table></code></pre></figure>

<p>The job should appear in the UI:
<img src="/assets/img/flink/operator/custom_sample_job.png" alt="Flink dashboard" /></p>

<h3 id="6-running-custom-pyflink-job">6. Running custom PyFlink job</h3>

<p>Earlier we detailed how we use the <strong>apache/flink:1.15.2</strong> image as a base image to build a custom image containing python, pyflink and other connectors. This is the same image we use to create and run our custom PyFlink jobs.</p>

<p>This follows a similar process:</p>

<ul>
  <li>
    <p>Create a custom docker image using the custom apache flink image with the custom python files / modules loaded</p>
  </li>
  <li>
    <p>Create a kubernetes job spec with the above custom image</p>
  </li>
  <li>
    <p>Submit the job into the kubernetes cluster</p>
  </li>
</ul>

<p>An example dockerfile could be:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="c"># Example dockerfile to build a custom image to run pyflink job</span>
<span class="c"># NOTE: The pyflink image must have python else it fails with python not found and job fails?</span>
FROM m1l0/pyflink:1.15.2-scala_2.12 as builder

WORKDIR /opt/flink

COPY pyflink_example.py .
</pre></td></tr></tbody></table></code></pre></figure>

<p>Create a job manifest as follows:
<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=flink_pyflink_session_example.yaml"></script></p>

<p>Note that the <strong>beam-flink-cluster-jobmanager</strong> is created as a service earlier. Here we run the custom pyflink file by using the <strong>/opt/flink/bin/flink</strong> CLI tool, passing in the <strong>–python</strong> argument which will cause the job to be parsed and submitted as a python code.</p>

<p>Submit the job and monitor the UI for job status.
<img src="/assets/img/flink/operator/custom_pyflink_job.png" alt="Flink dashboard" /></p>

<p>Access the job artifacts by execing into the <strong>taskmanager</strong> pod and accessing the <strong>taskmanager</strong> container since the job is run directly on the flink cluster this time.</p>

<h3 id="7-running-custom-pyflink-job-in-application-mode">7. Running custom PyFlink job in Application Mode</h3>

<p>The operator supports running jobs in either <strong>session</strong> or <strong>application</strong> mode. The steps before detailed job submission via the session mode to a standalone flink cluster.</p>

<p>When run in application mode, the operator creates an individual flink cluster with job and task managers to execute the job.</p>

<p>An example PyFlink application job:
<script src="https://gist.github.com/cheeyeo/fbbda6ecc4d94f14bba57c36276d6edd.js?file=flink_pyflink_job_example.yaml"></script></p>

<p><img src="/assets/img/flink/operator/application_pyflink.png" alt="Flink Application CLI" /></p>

<p>The operator creates a standalone flink cluster comprising of a jobmanager, taskmanager to run the job. It also creates 2 jobs: the actual job defined in the spec, and a <code class="language-plaintext highlighter-rouge">submitter</code> job which uses the flink CLI tool to submit the job and reports on it status and logs.</p>

<p>To view the status and logs of the job:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kubectl describe pod pyflink-wordcount-cluster-job-submitter-tn5zz
</pre></td></tr></tbody></table></code></pre></figure>

<p>Sample output of the logs:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre>...

    State:      Terminated
      Reason:   Completed
      Message:  jobID: 85cda7250d75e94dee8586f90f757871
message: |
  Successfully submitted!
  /opt/flink/bin/flink run <span class="nt">--jobmanager</span> pyflink-wordcount-cluster-jobmanager:8081 <span class="nt">--parallelism</span> 1 <span class="nt">--detached</span> <span class="nt">--python</span> examples/python/datastream/word_count.py <span class="nt">--output</span> /artifacts/application
  WARNING: An illegal reflective access operation has occurred
  WARNING: Illegal reflective access by org.apache.hadoop.security.authentication.util.KerberosUtil <span class="o">(</span>file:/opt/flink/lib/flink-shaded-hadoop-2-uber-2.8.3-7.0.jar<span class="o">)</span> to method sun.security.krb5.Config.getInstance<span class="o">()</span>
  WARNING: Please consider reporting this to the maintainers of org.apache.hadoop.security.authentication.util.KerberosUtil
  WARNING: Use <span class="nt">--illegal-access</span><span class="o">=</span>warn to <span class="nb">enable </span>warnings of further illegal reflective access operations
  WARNING: All illegal access operations will be denied <span class="k">in </span>a future release
  Job has been submitted with JobID 85cda7250d75e94dee8586f90f757871
  Executing word_count example with default input data set.
  Use <span class="nt">--input</span> to specify file input.

...
</pre></td></tr></tbody></table></code></pre></figure>

<p>Sample of the generated output:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="o">(</span>a,5<span class="o">)</span>
<span class="o">(</span>Be,1<span class="o">)</span>
<span class="o">(</span>Is,1<span class="o">)</span>
<span class="o">(</span>No,2<span class="o">)</span>
<span class="o">(</span>Or,1<span class="o">)</span>
<span class="o">(</span>To,4<span class="o">)</span>
<span class="o">(</span>be,1<span class="o">)</span>
<span class="o">(</span>by,2<span class="o">)</span>
<span class="o">(</span>he,1<span class="o">)</span>
<span class="o">(</span><span class="k">in</span>,3<span class="o">)</span>
<span class="o">(</span>is,2<span class="o">)</span>
<span class="o">(</span>my,1<span class="o">)</span>
<span class="o">(</span>of,14<span class="o">)</span>
<span class="o">(</span>or,1<span class="o">)</span>
<span class="o">(</span>so,1<span class="o">)</span>
<span class="o">(</span>to,7<span class="o">)</span>
<span class="o">(</span>us,3<span class="o">)</span>
<span class="o">(</span>we,4<span class="o">)</span>
<span class="o">(</span>And,5<span class="o">)</span>
<span class="o">(</span>But,1<span class="o">)</span>
...
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="cleanup">Cleanup</h3>

<p>One can delete the entire kind cluster using the following to remove all resources:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kind delete cluster <span class="nt">--name</span> flinkcluster
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="summary">Summary</h3>

<p>The post attempts to explain how to run a Flink cluster locally in a <strong>kind</strong> cluster using the Flink operator.</p>

<p>Using the operator has simplified the process of managing and applying various disparate kubernetes config files which is error prone. Defining a flink cluster and job as custom resource definition also simplifies resource management and further interoperability with the kubernetes API.</p>

<p>The downside of this approach is it involves more automation in order to package and deploy custom jobs locally into the cluster. I see this particular setup as more of a pre-deployment or test environment of a BEAM/Flink job before running it in an actual cluster remotely.</p>

<p>These are the remaining areas which remains to be researched on:</p>

<ul>
  <li>Install operator using helm chart</li>
  <li>Custom application to create a job resource dynamically</li>
  <li>Use of savepoints to save and restore running jobs</li>
  <li>Use of connectors such as S3 to save artifacts and savepoints remotely.</li>
</ul>

<p>H4ppy H4ck1n6 !!!</p>

</article>





      </div>
    </div>
  </div>

  <footer class="footer">
  <div class="p2 wrap">
    
      <div class="social-icons">
  <div class="">
    
      <a class="fa fa-github fa-lg" href="https://github.com/cheeyeo" target="_blank"></a>
    
    <a class="fa fa-rss fa-lg" href="https://www.cheeyeo.dev/feed.xml" target="_blank"></a>
    
    
    
      <a class="fa fa-envelope fa-lg" href="mailto:f/mnqwaypk"></a>
    
    
      <a class="fa fa-linkedin fa-lg" href="https://www.linkedin.com/in/cheeyeo" target="_blank"></a>
    
  </div>
</div>

    

    <div class="measure mt1 center">
      <strong>© 2022 Chee Yeo</strong><br/>
      <small>
        Built using the Pixll theme available on <a href="https://github.com/johno/pixyll" target="_blank">Github</a>.
      </small>
    </div>
  </div>
</footer>



</body>
</html>
